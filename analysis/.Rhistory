library(treemap)
# library
library(treemap)
library(d3treeR)
if (!requireNamespace("BiocManager", quietly = TRUE))
install.packages("BiocManager")
BiocManager::install("d3treeR")
# library
library(treemap)
library(d3treeR)
R.version
devtools::install_github("timelyportfolio/d3treeR")
# library
library(treemap)
library(d3treeR)
# dataset
group <- c(rep("group-1",4),rep("group-2",2),rep("group-3",3))
subgroup <- paste("subgroup" , c(1,2,3,4,1,2,1,2,3), sep="-")
value <- c(13,5,22,12,11,7,3,1,23)
data <- data.frame(group,subgroup,value)
View(data)
higher_tax <- read.csv(here('asv-output','higher_taxonomy.csv'))
?table
View(higher_tax)
class_table <- table(higher_tax$class, higher_tax$order)
class_df <- class_table %>%
as.data.frame() %>%
arrange(desc(Freq)) %>%
top_n(100)
View(class_df)
View(higher_tax)
class_order_table <- table(higher_tax$class, higher_tax$order)
class_table <- (table(higher_tax$class))
class_order_df <- class_order_table %>%
as.data.frame() %>%
arrange(desc(Freq)) %>%
top_n(100)
class_df <- class_table %>%
as.data.frame() %>%
arrange(desc(Freq)) %>%
top_n(100)
View(class_df)
View(class_order_df)
View(higher_tax)
class_order_table <- table(higher_tax$class, higher_tax$order, drop.na=FALSE)
class_order_table <- table(higher_tax$class, higher_tax$order)
class_table <- (table(higher_tax$class))
class_order_df <- class_order_table %>%
as.data.frame() %>%
arrange(desc(Freq)) %>%
top_n(100)
class_df <- class_table %>%
as.data.frame() %>%
arrange(desc(Freq)) %>%
top_n(100)
View(class_order_df)
# basic treemap
p <- treemap(data,
index=c("Var1","Var2"),
vSize="value",
type="index",
palette = "Set2",
bg.labels=c("white"),
align.labels=list(
c("center", "center"),
c("right", "bottom")
)
)
View(data)
# basic treemap
p <- treemap(data,
index=c("group","subgroup"),
vSize="value",
type="index",
palette = "Set2",
bg.labels=c("white"),
align.labels=list(
c("center", "center"),
c("right", "bottom")
)
)
rename(class_order_df, Var1=class, Var2=order)
rename(class_order_df, Var1="class", Var2="order")
class_order_df <- class_order_table %>%
as.data.frame() %>%
arrange(desc(Freq)) %>%
top_n(100) %>%
rename(class_order_df, Var1="class", Var2="order")
class_order_df <- class_order_table %>%
as.data.frame() %>%
arrange(desc(Freq)) %>%
top_n(100) %>%
rename(class_order_df, "Var1"="class", "Var2"="order")
class_order_df <- class_order_table %>%
as.data.frame() %>%
arrange(desc(Freq)) %>%
top_n(100) %>%
rename(class_order_df, Var1="class", Var2="order")
class_order_df <- class_order_table %>%
as.data.frame() %>%
arrange(desc(Freq)) %>%
top_n(100) %>%
rename(class_order_df, Var1="class", Var2="order")
class_order_df <- class_order_table %>%
as.data.frame() %>%
arrange(desc(Freq)) %>%
top_n(100) %>%
rename(class_order_df, Var1=class, Var2=order)
class_order_df <- class_order_table %>%
as.data.frame() %>%
arrange(desc(Freq)) %>%
top_n(100) %>%
rename(class_order_df, c(Var1=class, Var2=order))
class_order_df <- class_order_table %>%
as.data.frame() %>%
arrange(desc(Freq)) %>%
top_n(100) %>%
rename(Var1 = class) %>%
rename(Var2 = order)
class_order_df <- class_order_table %>%
as.data.frame() %>%
arrange(desc(Freq)) %>%
top_n(100) %>%
rename(class=Var1, order=Var2)
class_order_df <- class_order_df %>%
rename(Var1 = class, Var2 = order)
class_order_df <- class_order_df %>%
rename(class_order_df, Var1 = class, Var2 = order)
class_order_df <- class_order_table %>%
as.data.frame() %>%
arrange(desc(Freq)) %>%
top_n(100)
class_order_df <- rename(class_order_df, Var1 = class, Var2 = order)
class_order_df <- rename(class_order_df, Var1 = "class", Var2 = "order")
# basic treemap
p <- treemap(data,
index=c("class","order"),
vSize="value",
type="index",
palette = "Set2",
bg.labels=c("white"),
align.labels=list(
c("center", "center"),
c("right", "bottom")
)
)
# basic treemap
p <- treemap(class_order_df,
index=c("class","order"),
vSize="value",
type="index",
palette = "Set2",
bg.labels=c("white"),
align.labels=list(
c("center", "center"),
c("right", "bottom")
)
)
# basic treemap
p <- treemap(class_order_df,
index=c("class","order"),
vSize="Freq",
type="index",
palette = "Set2",
bg.labels=c("white"),
align.labels=list(
c("center", "center"),
c("right", "bottom")
)
)
class_order_df <- class_order_table %>%
as.data.frame() %>%
arrange(desc(Freq)) %>%
top_n(20)
class_order_df <- rename(class_order_df, Var1 = "class", Var2 = "order")
class_df <- class_table %>%
as.data.frame() %>%
arrange(desc(Freq)) %>%
top_n(100)
# basic treemap
p <- treemap(class_order_df,
index=c("class","order"),
vSize="Freq",
type="index",
palette = "Set2",
bg.labels=c("white"),
align.labels=list(
c("center", "center"),
c("right", "bottom")
)
)
# basic treemap
p <- treemap(class_order_df,
index=c("class","order"),
vSize="Freq",
type="index",
palette = "Set1",
bg.labels=c("white"),
align.labels=list(
c("center", "center"),
c("right", "bottom")
)
)
class_order_df <- class_order_table %>%
as.data.frame() %>%
arrange(desc(Freq)) %>%
top_n(10)
class_order_df <- rename(class_order_df, Var1 = "class", Var2 = "order")
class_df <- class_table %>%
as.data.frame() %>%
arrange(desc(Freq)) %>%
top_n(100)
# basic treemap
p <- treemap(class_order_df,
index=c("class","order"),
vSize="Freq",
type="index",
palette = "Set1",
bg.labels=c("white"),
align.labels=list(
c("center", "center"),
c("right", "bottom")
)
)
# basic treemap
p <- treemap(class_order_df,
index=c("class","order"),
vSize="Freq",
type="index",
palette = "Set3",
bg.labels=c("white"),
align.labels=list(
c("center", "center"),
c("right", "bottom")
)
)
# basic treemap
p <- treemap(class_order_df,
index=c("class","order"),
vSize="Freq",
type="index",
palette = "Set5",
bg.labels=c("white"),
align.labels=list(
c("center", "center"),
c("right", "bottom")
)
)
# basic treemap
p <- treemap(class_order_df,
index=c("class","order"),
vSize="Freq",
type="index",
palette = "Set4",
bg.labels=c("white"),
align.labels=list(
c("center", "center"),
c("right", "bottom")
)
)
# basic treemap
p <- treemap(class_order_df,
index=c("class","order"),
vSize="Freq",
type="index",
palette = "Set3",
bg.labels=c("white"),
align.labels=list(
c("center", "center"),
c("right", "bottom")
)
)
# basic treemap
p <- treemap(class_order_df,
index=c("class","order"),
vSize="Freq",
type="index",
palette = "Set1",
bg.labels=c("white"),
align.labels=list(
c("center", "center"),
c("right", "bottom")
)
)
class_order_df <- class_order_table %>%
as.data.frame() %>%
arrange(desc(Freq)) %>%
top_n(20)
class_order_df <- rename(class_order_df, Var1 = "class", Var2 = "order")
class_df <- class_table %>%
as.data.frame() %>%
arrange(desc(Freq)) %>%
top_n(100)
# basic treemap
p <- treemap(class_order_df,
index=c("class","order"),
vSize="Freq",
type="index",
palette = "Set1",
bg.labels=c("white"),
align.labels=list(
c("center", "center"),
c("right", "bottom")
)
)
save.image(rough_treemap, "rough_treemap.jpg", quality = 0.7)
save.image(rough_treemap, "rough_treemap.jpg")
# basic treemap
rough_treemap <- treemap(class_order_df,
index=c("class","order"),
vSize="Freq",
type="index",
palette = "Set1",
bg.labels=c("white"),
align.labels=list(
c("center", "center"),
c("right", "bottom")
)
)
save.image(rough_treemap, "rough_treemap.jpg")
save.image("rough_treemap.jpg")
save.image("rough_treemap.png")
# basic treemap
rough_treemap <- treemap(class_order_df,
index=c("class","order"),
vSize="Freq",
type="index",
palette = "Set1",
bg.labels=c("white"),
align.labels=list(
c("center", "center"),
c("right", "bottom")
)
)
jpeg("rough_treemap.jpeg")
jpeg("rough_treemap.jpeg")
# basic treemap
jpeg("rough_treemap.jpeg")
rough_treemap <- treemap(class_order_df,
index=c("class","order"),
vSize="Freq",
type="index",
palette = "Set1",
bg.labels=c("white"),
align.labels=list(
c("center", "center"),
c("right", "bottom")
)
)
dev.off()
# basic treemap
jpeg("rough_treemap.jpeg")
rough_treemap <- treemap(class_order_df,
index=c("class","order"),
vSize="Freq",
type="index",
palette = "Set1",
bg.labels=c("white"),
align.labels=list(
c("center", "center"),
c("right", "bottom")
)
)
dev.off()
?jpeg
# basic treemap
jpeg("rough_treemap.jpeg", width = 700, height = 700)
rough_treemap <- treemap(class_order_df,
index=c("class","order"),
vSize="Freq",
type="index",
palette = "Set1",
bg.labels=c("white"),
align.labels=list(
c("center", "center"),
c("right", "bottom")
)
)
dev.off()
?treemap
# basic treemap
jpeg("rough_treemap.jpeg", width = 700, height = 700)
rough_treemap <- treemap(class_order_df,
index=c("class","order"),
vSize="Freq",
type="index",
palette = "Set1",
bg.labels=c("white"),
align.labels=list(
c("center", "center"),
c("right", "bottom")
),
title="Class and Order Presence in Dataset"
)
dev.off()
# load Rarmon's data
ASV_table <- read.csv(here('asv-output','ASV_table_all_together.csv'))
taxonomy_table <- read.csv(here('asv-output','all.taxonomy.20190130.csv'))
# NA's in ASV_table hash?
sum(is.na(ASV_table$Hash))
sum(is.na(taxonomy_table$Hash))
# merge ASV table and taxonomy table on hash column
ASV_tax <- inner_join(ASV_table, taxonomy_table)
unique(ASV_tax$sample)
#OYSTERS filter
oysters <- ASV_tax %>%
#filter(genus %in% c('Ostrea','Crassostrea'))
filter(genus %in% c('Ostrea'))
oysters_str <- ASV_tax %>%
filter(str_detect(genus, 'Ostrea')) #these filters do the same thing
# balanus filter
balanus <- ASV_tax %>%
filter(str_detect(genus, 'Balanus'))
# STAR FEEESH
starfeesh <- ASV_tax %>%
filter(str_detect(family, "Asteriidae"))
# how bout octopus?
salmon <- ASV_tax %>%
filter(str_detect(family, "Salmonidae"))
# geoduck
geoduck <- ASV_tax %>%
filter(str_detect(family, 	"Hiatellidae"))
# LL filter
LL_oysters <- oysters %>%
filter(str_detect(sample, "LL"))
#Sample test filter
by_sample_test <- ASV_tax %>%
filter(str_detect(sample, "LL_201703"))
#taxonomy no.na
tax_nona <- taxonomy_table[!is.na(taxonomy_table$species), ]
View(by_sample_test)
#sanity check for class totals with class table
class_df <- class_table %>%
as.data.frame() %>%
arrange(desc(Freq)) %>%
top_n(100)
#treemap code (could make this interactive weidget for less clutter?)
jpeg("rough_treemap.jpeg", width = 700, height = 700)
rough_treemap <- treemap(class_order_df,
index=c("class","order"),
vSize="Freq",
type="index",
palette = "Set2",
bg.labels=c("white"),
align.labels=list(
c("center", "center"),
c("right", "bottom")
),
title="Class and Order Presence in Dataset"
)
rough_treemap <- treemap(class_order_df,
index=c("class","order"),
vSize="Freq",
type="index",
palette = "Spectral",
bg.labels=c("white"),
align.labels=list(
c("center", "center"),
c("right", "bottom")
),
title="Class and Order Presence in Dataset"
)
rough_treemap <- treemap(class_order_df,
index=c("class","order"),
vSize="Freq",
type="index",
palette = "Spectral",
bg.labels=c("white"),
align.labels=list(
c("center", "center"),
c("right", "bottom")
),
title="Class and Order Presence in Dataset"
)
rough_treemap <- treemap(class_order_df,
index=c("class","order"),
vSize="Freq",
type="index",
palette = "Set3",
bg.labels=c("white"),
align.labels=list(
c("center", "center"),
c("right", "bottom")
),
title="Class and Order Presence in Dataset"
)
rough_treemap <- treemap(class_order_df,
index=c("class","order"),
vSize="Freq",
type="index",
palette = "Dark2",
bg.labels=c("white"),
align.labels=list(
c("center", "center"),
c("right", "bottom")
),
title="Class and Order Presence in Dataset"
)
rough_treemap <- treemap(class_order_df,
index=c("class","order"),
vSize="Freq",
type="index",
palette = "Accent",
bg.labels=c("white"),
align.labels=list(
c("center", "center"),
c("right", "bottom")
),
title="Class and Order Presence in Dataset"
)
View(LL_oysters)
View(by_sample_test)
